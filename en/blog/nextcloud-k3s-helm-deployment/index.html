<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nextcloud K3S deployment using helm chart | MatSch Web</title><meta name=keywords content="kubernetes,k3s,nextcloud"><meta name=description content="The way I deployed nextcloud on my k3s cluster using helm chart"><meta name=author content><link rel=canonical href=https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/><link crossorigin=anonymous href=/de/assets/css/stylesheet.64d3743a7e35a5fe0e8aeebf460c23e9bd544d0457ddc54dd5d7c3a05fd0c665.css integrity="sha256-ZNN0On41pf4Oiu6/Rgwj6b1UTQRX3cVN1dfDoF/QxmU=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.matschcode.de/en/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.matschcode.de/en/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.matschcode.de/en/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.matschcode.de/en/apple-touch-icon.png><link rel=mask-icon href=https://blog.matschcode.de/en/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta property="og:image" content="https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment.png"><meta property="og:image:type" content="image/png/png"><meta property="og:image:width" content="1536"><meta property="og:image:height" content="1024"><link rel=alternate hreflang=de href=https://blog.matschcode.de/de/blog/nextcloud-k3s-helm-deployment/><link rel=alternate hreflang=en href=https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/"><meta property="og:site_name" content="MatSch Web"><meta property="og:title" content="Nextcloud K3S deployment using helm chart"><meta property="og:description" content="The way I deployed nextcloud on my k3s cluster using helm chart"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2025-12-19T00:00:00+00:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="K3s"><meta property="article:tag" content="Nextcloud"><meta property="og:image" content="https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment.png"><meta name=twitter:title content="Nextcloud K3S deployment using helm chart"><meta name=twitter:description content="The way I deployed nextcloud on my k3s cluster using helm chart"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://blog.matschcode.de/en/blog/"},{"@type":"ListItem","position":2,"name":"Nextcloud K3S deployment using helm chart","item":"https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nextcloud K3S deployment using helm chart","name":"Nextcloud K3S deployment using helm chart","description":"The way I deployed nextcloud on my k3s cluster using helm chart","keywords":["kubernetes","k3s","nextcloud"],"articleBody":"Introduction Nextcloud is a self-hosted collaboration platform that provides file synchronization and sharing, calendars, contacts, and a growing ecosystem of apps. It offers strong data ownership guarantees while still covering many use cases typically handled by managed cloud services. So my goal is to replace Google Drive, Contacs and Calendar with a self-hosted nextcloud instance.\nIn my homelab, I run a lightweight Kubernetes distribution based on k3s. To keep the deployment reproducible, maintainable, and aligned with cloud-native best practices, I decided to deploy Nextcloud using its Helm chart rather than relying on ad-hoc manifests or manual container setups. Helm allows me to describe the desired state declaratively, manage upgrades more safely, and keep configuration changes version-controlled. This is the first step to go to manage my K3S cluster using Argo CD.\nDuring the deployment process, I ran into several non-obvious challenges and application-specific configuration details that are easy to overlook when running Nextcloud on Kubernetes. This article documents the approach I took, the problems I encountered, and the solutions that worked for my k3s environment, with the goal of providing a practical reference for others attempting a similar setup.\nHelm Chart Setup Downloading the Helm Chart The first step was to obtain the official Nextcloud Helm chart. Rather than installing it directly from the repository on every deployment, I prefer to download and vendor the chart locally. This gives me full visibility into the defaults, allows me to track changes over time, and avoids surprises when upstream defaults change.\nhelm repo add nextcloud https://nextcloud.github.io/helm/ helm repo update By keeping the chart alongside my cluster configuration, I can review updates deliberately and test them before rolling them out to my homelab.\nValues File Structure The default values.yaml shipped with the chart is comprehensive but large. Modifying it directly quickly becomes unmaintainable, especially when comparing changes during upgrades.\nTo address this, I split the configuration into two files:\nvalues-default.yaml\nThis is the original values.yaml. It is not edited manually and serves as a reference for upstream changes.\nvalues.yaml\nThis file contains only my overrides and environment-specific configuration.\nThis approach has several advantages:\nClear separation between upstream defaults and my customizations Easier diffs when upgrading the chart Reduced risk of accidentally diverging from intended defaults When deploying, both files are applied, with values.yaml overriding the defaults.\nDesign Decisions Database Choice: SQLite First, MariaDB Later For the initial deployment, I deliberately chose SQLite as the database backend. In a homelab context, this significantly reduces complexity:\nNo additional database service to operate Faster initial setup Fewer moving parts while validating the deployment This decision was made with the explicit intention to migrate later. Once the deployment proved stable and usage increased, switching to MariaDB would be straightforward using the Helm chart’s database configuration options.\nThis staged approach allowed me to focus first on Kubernetes-specific concerns, and get familiar with Nextcloud, before introducing database operations and backups into the mix.\nRequired Modifications Trusted Domains for Custom Domain Access Nextcloud is strict about which hostnames it accepts requests from. When running behind an ingress controller or a LoadBalancer, this becomes especially important.\nI explicitly configured trusted domains to include:\nThe external domain exposed via ingress\nAny internal service names used for testing or debugging\nWithout this configuration, Nextcloud may refuse connections or redirect users unexpectedly. Managing trusted domains through Helm values ensures the configuration persists across pod restarts and upgrades.\nAdd the following section to your values.yaml file:\nnextcloud: trustedDomains: [localhost, ] Fixing the NextCloud App Store Connection To install the Contacts and Calendar apps, Nextcloud needs to connect to the Nextcloud App Store. In my case, the App Store view was empty and failed to load content.\nTo identify the issue, I tested connectivity to the App Store both from the k3s node and from inside the Nextcloud container:\ncurl https://apps.nextcloud.com The request worked on the node but failed inside the container. After some debugging, I traced the issue to CoreDNS in the kube-system namespace.\nThis can be fixed by editing the CoreDNS ConfigMap:\nkubectl edit configMap coredns -nkube-system Replace\nforward . /etc/resolv.conf with\nforward . 1.1.1.1 8.8.8.8 . This change mirrors the effective resolvers configured on the node. After applying it, the App Store loaded correctly and app installation worked as expected.\nDAV Configuration for Contacts and Calendar Access I followed the guide by Robin to migrate my Google Contacts and Calendar to Nextcloud: Moving Google Contacts and Calendar to NextCloud During DAVx⁵ setup process I got stuck on Grant Access step.\nTo support DAV clients such as DAVx⁵, additional configuration is required. This is solved by injecting a custom configuration file via Helm values and enabling the HTTPS client fix.\nnextcloud: configs: davx.config.php: |- \u003c?php $CONFIG = array( 'csrf.optout' =\u003e array( '/^WebDAVFS/', '/^Microsoft-WebDAV-MiniRedir/', '/RaiDrive/', '/CrKey/', '/Nextcloud-android/', '/Nextcloud-iOS/', ), ); phpClientHttpsFix: enabled: true protocol: https After applying this configuration, the Grant Access step on my Android device worked without issues.\nExtra Manifests Not everything fits cleanly into Helm values. For components that are adjacent to, but not strictly part of, the Nextcloud chart, I relied on extra manifests.\nThese manifests live alongside the Helm deployment and are applied as part of the same workflow. This keeps the overall deployment cohesive while still respecting the boundaries of the upstream chart.\nIn my case, I defined an external `LoadBalancer`` service:\nextraManifests: externalService: apiVersion: v1 kind: Service metadata: name: nextcloud-external-service namespace: nextcloud spec: type: LoadBalancer selector: app.kubernetes.io/component: app app.kubernetes.io/instance: nextcloud app.kubernetes.io/name: nextcloud ports: - protocol: TCP port: 8080 targetPort: 80 nodePort: Deployment With everything in place, deploying Nextcloud is straightforward:\nhelm install nextcloud ./nextcloud \\ -n nextcloud \\ --create-namespace \\ -f ./nextcloud/values-default.yaml \\ -f ./nextcloud/values.yaml Summary Deploying Nextcloud on a k3s cluster using Helm worked well, but it required more consideration than a simple helm install. By structuring configuration cleanly, making deliberate design decisions, and leveraging Helm features such as custom config files and extra manifests, I ended up with a setup that is both flexible and maintainable.\nThe next steps for this deployment include migrating to MariaDB, tightening security settings, and adding proper backup and monitoring workflows. Even in its current form, however, this approach provides a solid foundation for running Nextcloud reliably in a homelab Kubernetes environment.\n","wordCount":"1032","inLanguage":"en","image":"https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment.png","datePublished":"2025-12-19T00:00:00Z","dateModified":"2025-12-19T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/"},"publisher":{"@type":"Organization","name":"MatSch Web","logo":{"@type":"ImageObject","url":"https://blog.matschcode.de/en/favicon.ico"}}}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/nanogallery2@3.0.5/dist/css/nanogallery2.min.css></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://blog.matschcode.de/en/ accesskey=h title="MatSch Web (Alt + H)">MatSch Web</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.matschcode.de/de/ title=Deutsch aria-label=Deutsch>De</a></li></ul></div></div><ul id=menu><li><a href=https://blog.matschcode.de/en/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://blog.matschcode.de/en/blog/ title=Blog><span>Blog</span></a></li><li><a href=https://blog.matschcode.de/en/travel/ title=Travel><span>Travel</span></a></li><li><a href=https://blog.matschcode.de/en/about/ title=About><span>About</span></a></li><li><a href=https://blog.matschcode.de/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.matschcode.de/en/>Home</a>&nbsp;»&nbsp;<a href=https://blog.matschcode.de/en/blog/>Blog</a></div><h1 class="post-title entry-hint-parent">Nextcloud K3S deployment using helm chart</h1><div class=post-description>The way I deployed nextcloud on my k3s cluster using helm chart</div><div class=post-meta><span title='2025-12-19 00:00:00 +0000 UTC'>December 19, 2025</span>&nbsp;·&nbsp;<span>5 min</span>&nbsp;|&nbsp;<span>Translations:</span><ul class=i18n_list><li><a href=https://blog.matschcode.de/de/blog/nextcloud-k3s-helm-deployment/>De</a></li></ul></div></header><figure class=entry-cover><img loading=eager srcset='https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment_hu_a4c87ddf814604fa.png 360w,https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment_hu_cb41c5ed1a0b5229.png 480w,https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment_hu_f3d64ce52256aa5.png 720w,https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment_hu_bbc4331511cd3972.png 1080w,https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment_hu_e7c05cbec5f284a9.png 1500w,https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment.png 1536w' src=https://blog.matschcode.de/en/blog/nextcloud-k3s-helm-deployment/nextcloud-k3s-helm-deployment.png sizes="(min-width: 768px) 720px, 100vw" width=1536 height=1024 alt=nextcloud-k3s-helm-deployment><figcaption>The way I deployed nextcloud on my k3s cluster using helm chart</figcaption></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#helm-chart-setup aria-label="Helm Chart Setup">Helm Chart Setup</a><ul><li><a href=#downloading-the-helm-chart aria-label="Downloading the Helm Chart">Downloading the Helm Chart</a></li><li><a href=#values-file-structure aria-label="Values File Structure">Values File Structure</a></li></ul></li><li><a href=#design-decisions aria-label="Design Decisions">Design Decisions</a><ul><li><a href=#database-choice-sqlite-first-mariadb-later aria-label="Database Choice: SQLite First, MariaDB Later">Database Choice: SQLite First, MariaDB Later</a></li></ul></li><li><a href=#required-modifications aria-label="Required Modifications">Required Modifications</a><ul><li><a href=#trusted-domains-for-custom-domain-access aria-label="Trusted Domains for Custom Domain Access">Trusted Domains for Custom Domain Access</a></li><li><a href=#fixing-the-nextcloud-app-store-connection aria-label="Fixing the NextCloud App Store Connection">Fixing the NextCloud App Store Connection</a></li><li><a href=#dav-configuration-for-contacts-and-calendar-access aria-label="DAV Configuration for Contacts and Calendar Access">DAV Configuration for Contacts and Calendar Access</a></li><li><a href=#extra-manifests aria-label="Extra Manifests">Extra Manifests</a></li></ul></li><li><a href=#deployment aria-label=Deployment>Deployment</a></li><li><a href=#summary aria-label=Summary>Summary</a></li></ul></div></details></div><div class=post-content><h2 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h2><p>Nextcloud is a self-hosted collaboration platform that provides file synchronization and sharing, calendars, contacts, and a growing ecosystem of apps. It offers strong data ownership guarantees while still covering many use cases typically handled by managed cloud services.
So my goal is to replace Google Drive, Contacs and Calendar with a self-hosted nextcloud instance.</p><p>In my homelab, I run a lightweight Kubernetes distribution based on k3s.
To keep the deployment reproducible, maintainable, and aligned with cloud-native best practices, I decided to deploy Nextcloud using its Helm chart rather than relying on ad-hoc manifests or manual container setups.
Helm allows me to describe the desired state declaratively, manage upgrades more safely, and keep configuration changes version-controlled.
This is the first step to go to manage my K3S cluster using Argo CD.</p><p>During the deployment process, I ran into several non-obvious challenges and application-specific configuration details that are easy to overlook when running Nextcloud on Kubernetes.
This article documents the approach I took, the problems I encountered, and the solutions that worked for my k3s environment, with the goal of providing a practical reference for others attempting a similar setup.</p><h2 id=helm-chart-setup>Helm Chart Setup<a hidden class=anchor aria-hidden=true href=#helm-chart-setup>#</a></h2><h3 id=downloading-the-helm-chart>Downloading the Helm Chart<a hidden class=anchor aria-hidden=true href=#downloading-the-helm-chart>#</a></h3><p>The first step was to obtain the official Nextcloud Helm chart. Rather than installing it directly from the repository on every deployment, I prefer to download and vendor the chart locally. This gives me full visibility into the defaults, allows me to track changes over time, and avoids surprises when upstream defaults change.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm repo add nextcloud https://nextcloud.github.io/helm/
</span></span><span style=display:flex><span>helm repo update
</span></span></code></pre></div><p>By keeping the chart alongside my cluster configuration, I can review updates deliberately and test them before rolling them out to my homelab.</p><h3 id=values-file-structure>Values File Structure<a hidden class=anchor aria-hidden=true href=#values-file-structure>#</a></h3><p>The default <code>values.yaml</code> shipped with the chart is comprehensive but large. Modifying it directly quickly becomes unmaintainable, especially when comparing changes during upgrades.</p><p>To address this, I split the configuration into two files:</p><ul><li><p><code>values-default.yaml</code><br>This is the original <code>values.yaml</code>. It is not edited manually and serves as a reference for upstream changes.</p></li><li><p><code>values.yaml</code><br>This file contains only my overrides and environment-specific configuration.</p></li></ul><p>This approach has several advantages:</p><ul><li>Clear separation between upstream defaults and my customizations</li><li>Easier diffs when upgrading the chart</li><li>Reduced risk of accidentally diverging from intended defaults</li></ul><p>When deploying, both files are applied, with <code>values.yaml</code> overriding the defaults.</p><h2 id=design-decisions>Design Decisions<a hidden class=anchor aria-hidden=true href=#design-decisions>#</a></h2><h3 id=database-choice-sqlite-first-mariadb-later>Database Choice: SQLite First, MariaDB Later<a hidden class=anchor aria-hidden=true href=#database-choice-sqlite-first-mariadb-later>#</a></h3><p>For the initial deployment, I deliberately chose SQLite as the database backend. In a homelab context, this significantly reduces complexity:</p><ul><li>No additional database service to operate</li><li>Faster initial setup</li><li>Fewer moving parts while validating the deployment</li></ul><p>This decision was made with the explicit intention to migrate later. Once the deployment proved stable and usage increased, switching to MariaDB would be straightforward using the Helm chart’s database configuration options.</p><p>This staged approach allowed me to focus first on Kubernetes-specific concerns, and get familiar with Nextcloud, before introducing database operations and backups into the mix.</p><h2 id=required-modifications>Required Modifications<a hidden class=anchor aria-hidden=true href=#required-modifications>#</a></h2><h3 id=trusted-domains-for-custom-domain-access>Trusted Domains for Custom Domain Access<a hidden class=anchor aria-hidden=true href=#trusted-domains-for-custom-domain-access>#</a></h3><figure><img loading=lazy src=https://help.nextcloud.com/uploads/default/original/3X/d/b/dbdf5a0e3ed2d78800f42f3612ef88c623e9ad8d.png alt="Nextcloud untrusted domain error" width=600></figure><p>Nextcloud is strict about which hostnames it accepts requests from. When running behind an ingress controller or a LoadBalancer, this becomes especially important.</p><p>I explicitly configured trusted domains to include:</p><p>The external domain exposed via ingress</p><p>Any internal service names used for testing or debugging</p><p>Without this configuration, Nextcloud may refuse connections or redirect users unexpectedly. Managing trusted domains through Helm values ensures the configuration persists across pod restarts and upgrades.</p><p>Add the following section to your <code>values.yaml</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>nextcloud</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>trustedDomains</span>: [<span style=color:#ae81ff>localhost, &lt;yourdomain.com&gt;]</span>
</span></span></code></pre></div><h3 id=fixing-the-nextcloud-app-store-connection>Fixing the NextCloud App Store Connection<a hidden class=anchor aria-hidden=true href=#fixing-the-nextcloud-app-store-connection>#</a></h3><p>To install the Contacts and Calendar apps, Nextcloud needs to connect to the Nextcloud App Store. In my case, the App Store view was empty and failed to load content.</p><figure><a href=https://forum.yunohost.org/t/nextcloud-appstore-does-not-work/30804><img loading=lazy src=https://forum.yunohost.org/uploads/default/original/2X/6/6c1ca5c9b3e6c1f5c36a7d64e700b0f8078f208e.png alt="Nextcloud App Store connection error" width=600></a></figure><p>To identify the issue, I tested connectivity to the App Store both from the k3s node and from inside the Nextcloud container:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl https://apps.nextcloud.com
</span></span></code></pre></div><p>The request worked on the node but failed inside the container. After some debugging, I traced the issue to CoreDNS in the kube-system namespace.</p><p>This can be fixed by editing the CoreDNS ConfigMap:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl edit configMap coredns -nkube-system
</span></span></code></pre></div><p>Replace</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>forward . /etc/resolv.conf
</span></span></code></pre></div><p>with</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>forward . 1.1.1.1 8.8.8.8
</span></span></code></pre></div><p>.
This change mirrors the effective resolvers configured on the node. After applying it, the App Store loaded correctly and app installation worked as expected.</p><h3 id=dav-configuration-for-contacts-and-calendar-access>DAV Configuration for Contacts and Calendar Access<a hidden class=anchor aria-hidden=true href=#dav-configuration-for-contacts-and-calendar-access>#</a></h3><p>I followed the guide by Robin to migrate my Google Contacts and Calendar to Nextcloud:
<a href=https://selfhostedheaven.com/posts/20220116-moving-google-contacts-and-calendar-to-nextcloud/>Moving Google Contacts and Calendar to NextCloud</a>
During DAVx⁵ setup process I got stuck on <code>Grant Access</code> step.</p><figure><a href=https://itcamefromtheinternet.com/blog/nextcloud-android-sync/><img loading=lazy src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRmZPWsy7ripvR1b7OIfdfyon23ykeLuhSVHA&amp;s" alt="Nextcloud DAV Grant Access issue" width=300></a></figure><p>To support DAV clients such as DAVx⁵, additional configuration is required. This is solved by injecting a custom configuration file via Helm values and enabling the HTTPS client fix.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>nextcloud</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>configs</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>davx.config.php</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;?php
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      $CONFIG = array(
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#39;csrf.optout&#39; =&gt; array(
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &#39;/^WebDAVFS/&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &#39;/^Microsoft-WebDAV-MiniRedir/&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &#39;/RaiDrive/&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &#39;/CrKey/&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &#39;/Nextcloud-android/&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          &#39;/Nextcloud-iOS/&#39;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ),</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>phpClientHttpsFix</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>https</span>
</span></span></code></pre></div><p>After applying this configuration, the <code>Grant Access</code> step on my Android device worked without issues.</p><h3 id=extra-manifests>Extra Manifests<a hidden class=anchor aria-hidden=true href=#extra-manifests>#</a></h3><p>Not everything fits cleanly into Helm values. For components that are adjacent to, but not strictly part of, the Nextcloud chart, I relied on extra manifests.</p><p>These manifests live alongside the Helm deployment and are applied as part of the same workflow. This keeps the overall deployment cohesive while still respecting the boundaries of the upstream chart.</p><p>In my case, I defined an external `LoadBalancer`` service:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>extraManifests</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>externalService</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nextcloud-external-service</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>nextcloud</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>type</span>: <span style=color:#ae81ff>LoadBalancer</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app.kubernetes.io/component</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>app.kubernetes.io/instance</span>: <span style=color:#ae81ff>nextcloud</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>app.kubernetes.io/name</span>: <span style=color:#ae81ff>nextcloud</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>&lt;nodePort&gt;</span>
</span></span></code></pre></div><h2 id=deployment>Deployment<a hidden class=anchor aria-hidden=true href=#deployment>#</a></h2><p>With everything in place, deploying Nextcloud is straightforward:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>helm install nextcloud ./nextcloud <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -n nextcloud <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --create-namespace <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -f ./nextcloud/values-default.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -f ./nextcloud/values.yaml
</span></span></code></pre></div><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>Deploying Nextcloud on a k3s cluster using Helm worked well, but it required more consideration than a simple helm install. By structuring configuration cleanly, making deliberate design decisions, and leveraging Helm features such as custom config files and extra manifests, I ended up with a setup that is both flexible and maintainable.</p><p>The next steps for this deployment include migrating to MariaDB, tightening security settings, and adding proper backup and monitoring workflows. Even in its current form, however, this approach provides a solid foundation for running Nextcloud reliably in a homelab Kubernetes environment.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.matschcode.de/en/tags/kubernetes/>Kubernetes</a></li><li><a href=https://blog.matschcode.de/en/tags/k3s/>K3s</a></li><li><a href=https://blog.matschcode.de/en/tags/nextcloud/>Nextcloud</a></li></ul><nav class=post-nav><a class=prev href=/en/blog/giscus-hugo-comments/>← Setting up Giscus comments for Hugo blog</a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Nextcloud K3S deployment using helm chart on x" href="https://x.com/intent/tweet/?text=Nextcloud%20K3S%20deployment%20using%20helm%20chart&amp;url=https%3a%2f%2fblog.matschcode.de%2fen%2fblog%2fnextcloud-k3s-helm-deployment%2f&amp;hashtags=kubernetes%2ck3s%2cnextcloud"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nextcloud K3S deployment using helm chart on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.matschcode.de%2fen%2fblog%2fnextcloud-k3s-helm-deployment%2f&amp;title=Nextcloud%20K3S%20deployment%20using%20helm%20chart&amp;summary=Nextcloud%20K3S%20deployment%20using%20helm%20chart&amp;source=https%3a%2f%2fblog.matschcode.de%2fen%2fblog%2fnextcloud-k3s-helm-deployment%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nextcloud K3S deployment using helm chart on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.matschcode.de%2fen%2fblog%2fnextcloud-k3s-helm-deployment%2f&title=Nextcloud%20K3S%20deployment%20using%20helm%20chart"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nextcloud K3S deployment using helm chart on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.matschcode.de%2fen%2fblog%2fnextcloud-k3s-helm-deployment%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nextcloud K3S deployment using helm chart on whatsapp" href="https://api.whatsapp.com/send?text=Nextcloud%20K3S%20deployment%20using%20helm%20chart%20-%20https%3a%2f%2fblog.matschcode.de%2fen%2fblog%2fnextcloud-k3s-helm-deployment%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nextcloud K3S deployment using helm chart on telegram" href="https://telegram.me/share/url?text=Nextcloud%20K3S%20deployment%20using%20helm%20chart&amp;url=https%3a%2f%2fblog.matschcode.de%2fen%2fblog%2fnextcloud-k3s-helm-deployment%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Nextcloud K3S deployment using helm chart on ycombinator" href="https://news.ycombinator.com/submitlink?t=Nextcloud%20K3S%20deployment%20using%20helm%20chart&u=https%3a%2f%2fblog.matschcode.de%2fen%2fblog%2fnextcloud-k3s-helm-deployment%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=matsch1/web data-repo-id=R_kgDOOj9vMw data-category=Announcements data-category-id=DIC_kwDOOj9vM84CzTmb data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=dark_protanopia data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.matschcode.de/en/>MatSch Web</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script src=https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js></script><script src=https://cdn.jsdelivr.net/npm/nanogallery2@3.0.5/dist/jquery.nanogallery2.min.js></script><script src=https://cdn.counter.dev/script.js data-id=ad3d8a1d-120c-4f64-a5cf-2ae40ee7113b data-utcoffset=2></script></body></html>