{{- $pageurl := .Permalink }}
{{- $title := .Title }}

{{- $.Scratch.Set "tags" ""}}

{{- with .Params.Tags }}
{{- $hashtags := newScratch}}
{{- range . }}{{ $hashtags.Add "tags" (slice (replaceRE "(\\s)" "" . ))}}{{end}}
{{- $.Scratch.Set "tags" (delimit ($hashtags.Get "tags") ",") }}
{{- end -}}

{{- $custom := false }}
{{- $ShareButtons := (.Param "ShareButtons")}}
{{- with $ShareButtons }}{{ $custom = true }}{{ end }}

<ul class="share-buttons">
  Share
  <li>
    <button id="general-share" aria-label="Share this link">
      <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="currentColor">
        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.52.47 1.2.77 1.96.77 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L7.94 11.29C7.42 10.82 6.74 10.5 6 10.5c-1.66 0-3 1.34-3 3s1.34 3 3 3c.74 0 1.42-.32 1.94-.83l7.12 4.14c-.05.21-.08.43-.08.66 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3z"/>
      </svg>
    </button>
  </li>
</ul>

<script>
  document.getElementById('general-share').addEventListener('click', async () => {
    const shareData = {
      title: '{{ $title }}',
      text: '{{ $title }}',
      url: '{{ $pageurl }}'
    };

    if (navigator.share) {
      // Use Web Share API if available
      try {
        await navigator.share(shareData);
        console.log('Successfully shared');
      } catch (err) {
        console.log(`Error: ${err.message}`);
      }
    } else {
      // Fallback: Copy URL to clipboard
      try {
        await navigator.clipboard.writeText(shareData.url);
        alert('Link copied to clipboard!'); // Provide user feedback
        console.log('Link copied to clipboard');
      } catch (err) {
        console.log(`Fallback failed: ${err.message}`);
      }
    }
  });
</script>
